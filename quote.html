<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>艺达·ART报价单</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      @font-face {
        font-family: 'LucideIcons';
        src: url(https://cdn.jsdelivr.net/npm/lucide-static@latest/font/Lucide.ttf) format('truetype');
      }
      .lucide {
        font-family: 'LucideIcons';
        font-style: normal;
        font-weight: normal;
        font-variant: normal;
        text-transform: none;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      input[type="file"] {
        color: transparent;
      }
      input[type="file"]::file-selector-button {
        @apply px-3 py-1.5 text-sm font-semibold bg-[#4CAF50] text-white border border-transparent rounded-md cursor-pointer hover:bg-[#388e3c] transition-colors duration-200 ease-in-out;
      }
      input[type=number]::-webkit-inner-spin-button,
      input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type=number] {
        -moz-appearance: textfield;
      }
      *:focus-visible {
        outline: 2px solid #4CAF50;
        outline-offset: 2px;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);
        padding: 2rem;
        border-radius: 1rem 1rem 0 0;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        text-align: center;
      }
      .header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      .header nav {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
      }
      .header nav a {
        color: white;
        text-decoration: none;
        padding: 0.75rem 1.5rem;
        background: rgba(255, 255, 作品尺寸(cm)255, 0.1);
        border-radius: 9999px;
        font-weight: 500;
        transition: all 0.3s ease;
      }
      .header nav a:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      /* Info Section */
      .info {
        background: #fff;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
      }
      .info label {
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
      }
      .info input, .info select, .footer input {
        @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4CAF50] focus:border-transparent transition-all duration-200;
      }

      /* Table */
      #quoteTable {
        border-collapse: collapse;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        background: white;
        width: 100%;
      }
      #quoteTable th {
        position: sticky;
        top: 0;
        z-index: 10;
        background: linear-gradient(135deg, #4CAF50, #388e3c);
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        padding: 1rem;
        font-size: 0.9rem;
      }
      #quoteTable th:nth-child(1) { width: 5%; } /* 序号 */
      #quoteTable th:nth-child(2) { width: 10%; } /* 画作形式 */
      #quoteTable th:nth-child(3) { width: 25%; } /* 参数 */
      #quoteTable th:nth-child(4) { width: 15%; } /* 作品尺寸 */
      #quoteTable th:nth-child(5) { width: 8%; } /* 数量 */
      #quoteTable th:nth-child(6) { width: 12%; } /* 平方小计 */
      #quoteTable th:nth-child(7) { width: 8%; } /* 价格 */
      #quoteTable th:nth-child(8) { width: 12%; } /* 画芯构图 */
      #quoteTable th:nth-child(9) { width: 5%; } /* 操作 */
      #quoteTable td {
        padding: 1rem;
        color: #374151;
      }
      #quoteTable tr:nth-child(even) {
        background: #f9fafb;
      }
      #quoteTable tr {
        transition: background 0.2s ease;
      }
      #quoteTable tr:hover {
        background: #e8f5e9;
      }
      .image-preview {
        border-radius: 0.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }
      .image-preview:hover {
        transform: scale(1.05);
      }
      .image-upload-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
      }
      .image-upload {
        position: relative;
        width: 100%;
        max-width: 120px;
        text-align: center;
      }
      .image-upload::before {
        content: '选择文件';
        display: inline-block;
        background: linear-gradient(135deg, #4CAF50, #388e3c);
        color: white;
        font-size: 0.9rem;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .image-upload:hover::before {
        background: linear-gradient(135deg, #388e3c, #2e7d32);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .image-upload input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }
      .image-upload input[type="file"]::file-selector-button {
        display: none;
      }

      /* Buttons */
      .button-group {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
      }
      .button-group button {
        background: linear-gradient(135deg, #4CAF50, #388e3c);
        padding: 0.75rem 1.5rem;
        border-radius: 9999px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .button-group button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
      }
      .btn-delete {
        font-size: 1.25rem;
        padding: 0.5rem;
        border-radius: 50%;
        color: #ef4444;
        transition: all 0.2s ease;
      }
      .btn-delete:hover {
        background: #fee2e2;
        color: #dc2626;
      }

      /* Total Section */
      .total-container {
        display: flex;
        justify-content: flex-end;
        margin-top: 2rem;
      }
      .total {
        background: linear-gradient(to right, #f0fdf4, #e8f5e9);
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        width: 100%;
        max-width: 400px;
      }
      .total div {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }
      .total-label {
        color: #2e7d32;
        font-weight: 700;
        width: 120px;
      }
      .total-value {
        font-size: 1.25rem;
        font-weight: 800;
        color: #1f2937;
      }

      /* Footer */
      .footer {
        background: #f9fafb;
        border-top: 2px solid #e5e7eb;
        padding: 2rem;
        border-radius: 0 0 1rem 1rem;
        margin-top: 2.5rem;
      }
      .footer label, .footer span {
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
      }

      /* Mobile Styles */
      @media (max-width: 640px) {
        #quoteTable thead {
          display: none;
        }
        #quoteTable tbody, #quoteTable tr {
          display: block;
          width: 100%;
        }
        #quoteTable tr {
          border-radius: 0.75rem;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: white;
        }
        #quoteTable td {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 0.5rem 0.75rem;
          font-size: 0.85rem;
          border-bottom: 1px solid #e5e7eb;
        }
        #quoteTable td:last-child {
          border-bottom: none;
        }
        #quoteTable td::before {
          content: attr(data-label);
          font-weight: 600;
          color: #4CAF50;
          font-size: 0.85rem;
          flex: 0 0 35%;
          text-align: left;
        }
        #quoteTable td[data-label="序号"] {
          font-size: 1.25rem;
          font-weight: 700;
          color: #4CAF50;
          justify-content: flex-start;
          padding: 0.5rem 0.75rem;
        }
        #quoteTable td[data-label="序号"]::before {
          display: none;
        }
        #quoteTable td[data-label="画作形式"] input,
        #quoteTable td[data-label="数量"] input,
        #quoteTable td[data-label="价格(￥)"] input {
          flex: 1;
          max-width: 120px;
        }
        #quoteTable td[data-label="作品尺寸(cm)"] .size-group {
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
          justify-content: flex-end;
          width: 100%;
        }
        #quoteTable td[data-label="作品尺寸(cm)"] .size-group div {
          flex: 1;
          min-width: 100px;
          max-width: 120px;
        }
        #quoteTable td[data-label="作品尺寸(cm)"] .size-group input {
          width: 100%;
        }
        #quoteTable td[data-label="参数"] .param-group {
          display: none;
          position: absolute;
          background: white;
          padding: 0.75rem;
          border-radius: 0.5rem;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          z-index: 20;
          width: 90%;
          left: 5%;
          top: 100%;
        }
        #quoteTable td[data-label="参数"]:hover .param-group {
          display: block;
        }
        #quoteTable td[data-label="参数"]::after {
          content: "点击查看参数";
          display: block;
          color: #4CAF50;
          cursor: pointer;
          font-size: 0.85rem;
        }
        #quoteTable td[data-label="画芯构图"] .image-upload-container {
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: flex-end;
          gap: 0.5rem;
          width: 100%;
        }
        #quoteTable td[data-label="画芯构图"] .image-upload {
          max-width: 100px;
        }
        #quoteTable td[data-label="画芯构图"] .image-upload::before {
          font-size: 0.8rem;
          padding: 0.4rem 0.8rem;
        }
        #quoteTable td[data-label="画芯构图"] .image-preview {
          width: 40px;
          height: 40px;
        }
        #quoteTable td[data-label="操作"] {
          justify-content: flex-end;
        }
        .button-group {
          flex-direction: column;
          gap: 1rem;
        }
        .info, .footer {
          padding: 1rem;
        }
        .total-container {
          justify-content: center;
        }
        .total {
          width: 100%;
        }
        .total div {
          font-size: 1rem;
        }
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'PingFang SC', 'Helvetica Neue', 'Arial', 'sans-serif'],
            },
            colors: {
              primary: '#4CAF50',
              'primary-hover': '#388e3c',
              'primary-light': '#e8f5e9',
            }
          }
        }
      }

      const UNIT_PRICE_PER_SQ_METER = 1600;
      const PLACEHOLDER_IMAGE_URL = 'https://placehold.co/100x100/f0f5ff/003366?text=Preview';

      function toChineseNum(num) {
        const chnNumChar = ["零", "壹", "贰", "叁", "肆", "伍", "陆", "柒", "捌", "玖"];
        const chnUnitSection = ["", "万", "亿", "万亿", "亿亿"];
        const chnUnitChar = ["", "拾", "佰", "仟"];
        let unitPos = 0, strIns = '', chnStr = '', needZero = false;
        if (num === 0) return chnNumChar[0] + '元';
        let integerNum = Math.floor(num);
        while (integerNum > 0) {
          let section = integerNum % 10000;
          if (needZero) chnStr = chnNumChar[0] + chnStr;
          strIns = sectionToChinese(section, chnNumChar, chnUnitChar);
          strIns += (section !== 0) ? chnUnitSection[unitPos] : chnUnitSection[0];
          chnStr = strIns + chnStr;
          needZero = (section < 1000 && section > 0);
          integerNum = Math.floor(integerNum / 10000);
          unitPos++;
        }
        chnStr += '元';
        chnStr = chnStr.replace(/^壹拾/, '拾').replace(/零(拾|佰|仟)/g, '零')
          .replace(/零{2,}/g, '零').replace(/零([万亿])/g, '$1')
          .replace(/零+元/, '元').replace(/亿万/, '亿');
        if (chnStr.endsWith('零元')) chnStr = chnStr.slice(0, -2) + '元';
        return chnStr;
      }
      function sectionToChinese(section, chnNumChar, chnUnitChar) {
        let strIns = '', chnStr = '', unitPos = 0, zero = true;
        while (section > 0) {
          let v = section % 10;
          if (v === 0) { if (!zero) { zero = true; chnStr = chnNumChar[v] + chnStr; } }
          else { zero = false; strIns = chnNumChar[v]; strIns += chnUnitChar[unitPos]; chnStr = strIns + chnStr; }
          unitPos++; section = Math.floor(section / 10);
        }
        if (chnStr.endsWith(chnNumChar[0])) chnStr = chnStr.slice(0, -1);
        return chnStr;
      }

      function calculateRow(element) {
        const row = element.closest('tr');
        if (!row) return;
        const widthInput = row.querySelector('.width');
        const heightInput = row.querySelector('.height');
        const quantityInput = row.querySelector('.quantity');
        const areaSpan = row.querySelector('.area');
        const priceInput = row.querySelector('.price');
        const width = parseFloat(widthInput.value) || 0;
        const height = parseFloat(heightInput.value) || 0;
        let quantity = parseInt(quantityInput.value) || 1;
        if (quantity < 1) { quantity = 1; quantityInput.value = 1; }
        const area = (width * height / 10000 * quantity).toFixed(2);
        areaSpan.textContent = area;
        if (!priceInput.dataset.custom) {
          const price = Math.round(area * UNIT_PRICE_PER_SQ_METER);
          priceInput.value = price;
        }
        calculateTotal();
      }

      function markCustomPrice(input) {
        let price = parseFloat(input.value);
        if (isNaN(price) || price < 0) { price = 0; input.value = 0; }
        input.dataset.custom = 'true';
        calculateTotal();
      }

      function calculateTotal() {
        let totalPrice = 0, totalArea = 0;
        document.querySelectorAll('#quoteBody tr').forEach(row => {
          const price = parseFloat(row.querySelector('.price').value) || 0;
          const area = parseFloat(row.querySelector('.area').textContent) || 0;
          totalPrice += price;
          totalArea += area;
        });
        document.getElementById('totalPrice').textContent = totalPrice.toFixed(0);
        document.getElementById('totalArea').textContent = totalArea.toFixed(2);
        document.getElementById('totalPriceCN').textContent = toChineseNum(totalPrice);
      }

      function addRow() {
        const tbody = document.getElementById('quoteBody');
        const rowCount = tbody.children.length + 1;
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td data-label="序号" class="text-center font-medium">${rowCount}</td>
          <td data-label="画作形式">
            <input type="text" value="手绘" class="art-type w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
          </td>
          <td data-label="参数">
            <div class="param-group space-y-2">
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600 whitespace-nowrap">画芯:</span>
                <input type="text" class="core w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm" value="定制画芯">
              </div>
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600 whitespace-nowrap">画布:</span>
                <input type="text" class="canvas w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm" value="棉麻油画布">
              </div>
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600 whitespace-nowrap">外框:</span>
                <input type="text" class="outer-frame w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm" value="无框画">
              </div>
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600 whitespace-nowrap">内框:</span>
                <input type="text" class="inner-frame w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm" value="松木">
              </div>
            </div>
          </td>
          <td data-label="作品尺寸(cm)">
            <div class="size-group space-y-2">
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600 whitespace-nowrap">宽:</span>
                <input type="number" class="width w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm text-center" value="0" min="0" step="0.1" oninput="calculateRow(this)">
              </div>
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600 whitespace-nowrap">高:</span>
                <input type="number" class="height w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm text-center" value="0" min="0" step="0.1" oninput="calculateRow(this)">
              </div>
            </div>
          </td>
          <td data-label="数量" class="text-center">
            <input type="number" class="quantity w-full sm:w-16 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm text-center" value="1" min="1" oninput="calculateRow(this)">
          </td>
          <td data-label="平方小计(m²)" class="text-center">
            <span class="area font-medium">0.00</span>
          </td>
          <td data-label="价格(￥)" class="text-center">
            <div class="relative inline-block w-full sm:w-auto">
              <span class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500 text-xs hidden sm:inline">￥</span>
              <input type="number" class="price w-full sm:w-20 sm:pl-5 pr-2 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm text-right font-semibold bg-gray-50" value="0" min="0" step="1" oninput="markCustomPrice(this)">
            </div>
          </td>
          <td data-label="画芯构图" class="text-center align-middle">
            <div class="image-upload-container">
              <label class="image-upload">
                <input type="file" accept="image/*" onchange="previewImage(this)">
              </label>
              <img class="image-preview h-16 w-16 object-contain rounded border border-gray-200 bg-gray-50" src="${PLACEHOLDER_IMAGE_URL}" alt="Image Preview" style="display: none;" onerror="this.src='https://placehold.co/100x100/f8f8f8/cccccc?text=Error';">
            </div>
          </td>
          <td data-label="操作" class="text-center">
            <button class="btn-delete" onclick="removeRow(this)" title="删除此行">
              <span class="lucide"></span>
            </button>
          </td>
        `;
        tbody.appendChild(newRow);
        newRow.style.opacity = '0';
        setTimeout(() => {
          newRow.style.transition = 'opacity 0.3s ease';
          newRow.style.opacity = '1';
        }, 10);
        calculateRow(newRow.querySelector('.width'));
      }

      function removeRow(button) {
        const row = button.closest('tr');
        const tbody = document.getElementById('quoteBody');
        if (tbody.children.length > 1) {
          row.style.transition = 'opacity 0.3s ease';
          row.style.opacity = '0';
          setTimeout(() => {
            row.remove();
            updateRowNumbers();
            calculateTotal();
          }, 300);
        } else {
          alert("无法删除最后一行报价，请至少保留一行！");
        }
      }

      function updateRowNumbers() {
        document.querySelectorAll('#quoteBody tr').forEach((row, index) => {
          const seqCell = row.querySelector('td[data-label="序号"]');
          if (seqCell) seqCell.textContent = index + 1;
        });
      }

      function previewImage(input) {
        const file = input.files[0];
        const imgPreview = input.closest('.image-upload-container').querySelector('.image-preview');
        if (file && imgPreview) {
          const reader = new FileReader();
          reader.onload = e => { imgPreview.src = e.target.result; imgPreview.style.display = 'block'; };
          reader.onerror = () => { imgPreview.src = 'https://placehold.co/100x100/f8f8f8/cccccc?text=Load+Error'; imgPreview.style.display = 'block'; };
          reader.readAsDataURL(file);
        } else if (imgPreview) {
          imgPreview.style.display = 'none'; imgPreview.src = PLACEHOLDER_IMAGE_URL;
        }
      }

      function setCurrentDate() {
        const today = new Date();
        document.getElementById('currentDate').textContent = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
      }

      function updateTitle() {
        const studioName = document.getElementById('studioName').value;
        document.getElementById('quoteTitle').textContent = `${studioName}报价单`;
        document.title = `报价单 - ${studioName}`;
      }

      function exportToExcel() {
        const studioName = document.getElementById('studioName').value;
        const customerName = document.getElementById('customerName').value || 'N/A';
        const customerAddress = document.getElementById('customerAddress').value || 'N/A';
        const quoter = document.getElementById('quoter').value || 'N/A';
        const currentDate = document.getElementById('currentDate').textContent;
        const approver = document.getElementById('approver').value || 'N/A';
        const contactPhone = document.getElementById('contactPhone').value || '18059018257';
        const footerContactPhone = document.getElementById('footerContactPhone').value || '18059018257';
        const totalPrice = document.getElementById('totalPrice').textContent;
        const totalArea = document.getElementById('totalArea').textContent;
        const totalPriceCN = document.getElementById('totalPriceCN').textContent;

        const wb = XLSX.utils.book_new();
        const wsData = [
          [`${studioName}报价单`], [],
          ["报价单位:", studioName, "", "联系电话:", contactPhone],
          ["客户名称:", customerName, "", "联系地址:", customerAddress], [],
          ["序号", "画作形式", "参数", "作品尺寸(cm)", "数量", "平方小计(m²)", "价格(￥)", "是否自定义价格"]
        ];
        document.querySelectorAll('#quoteBody tr').forEach(row => {
          const params = [`画芯: ${row.querySelector('.core').value}`, `画布: ${row.querySelector('.canvas').value}`, `外框: ${row.querySelector('.outer-frame').value}`, `内框: ${row.querySelector('.inner-frame').value}`].join('; ');
          const dimensions = `宽:${row.querySelector('.width').value} 高:${row.querySelector('.height').value}`;
          let seqNum = 1;
          const seqCell = row.querySelector('td[data-label="序号"]');
          if (seqCell) seqNum = parseInt(seqCell.textContent) || 1;
          const isCustomPrice = row.querySelector('.price').dataset.custom === 'true' ? '是' : '否';
          wsData.push([
            seqNum,
            row.querySelector('.art-type').value, params, dimensions,
            parseInt(row.querySelector('.quantity').value),
            parseFloat(row.querySelector('.area').textContent),
            parseFloat(row.querySelector('.price').value),
            isCustomPrice
          ]);
        });
        const totalRowIndex = wsData.length;
        wsData.push([]);
        wsData.push(["合计平方数:", totalArea + " m²", "", "合计小写:", "￥" + totalPrice, "", "合计大写:", totalPriceCN]);
        const footerStartIndex = wsData.length;
        wsData.push([]);
        wsData.push(["报价人:", quoter, "", "报价日期:", currentDate, "", "审批:", approver]);
        wsData.push(["公司地址:", "福建省福州市仓山区建新镇后巷路2号", "", "联系电话:", footerContactPhone]);

        const ws = XLSX.utils.aoa_to_sheet(wsData);
        const headerRowIdx = 5;
        const dataStartRowIdx = headerRowIdx + 1;
        const dataEndRowIdx = totalRowIndex - 1;
        const totalRowIdxData = totalRowIndex + 1;
        const footerStartIdxData = footerStartIndex + 1;

        const styles = {
          title: { font: { sz: 16, bold: true }, alignment: { horizontal: 'center', vertical: 'center' } },
          header: { font: { bold: true, color: { rgb: "FFFFFF" } }, fill: { fgColor: { rgb: "4CAF50" } }, alignment: { horizontal: 'center', vertical: 'center', wrapText: true }, border: { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } } },
          cell: { border: { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } }, alignment: { vertical: 'center', wrapText: true } },
          cellCenter: { border: { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } }, alignment: { horizontal: 'center', vertical: 'center', wrapText: true } },
          cellRight: { border: { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } }, alignment: { horizontal: 'right', vertical: 'center', wrapText: true } },
          infoLabel: { font: { bold: true }, alignment: { horizontal: 'right', vertical: 'center' }, fill: { fgColor: { rgb: "F3F4F6" } } },
          infoValue: { alignment: { horizontal: 'left', vertical: 'center' }, fill: { fgColor: { rgb: "F3F4F6" } } },
          totalLabel: { font: { bold: true }, alignment: { horizontal: 'right', vertical: 'center' }, fill: { fgColor: { rgb: "E0E7FF" } }, border: { top: { style: "medium", color: { rgb: "000000" } } } },
          totalValue: { font: { bold: true }, alignment: { horizontal: 'left', vertical: 'center' }, fill: { fgColor: { rgb: "E0E7FF" } }, border: { top: { style: "medium", color: { rgb: "000000" } } } },
          totalValueRight: { font: { bold: true }, alignment: { horizontal: 'right', vertical: 'center' }, fill: { fgColor: { rgb: "E0E7FF" } }, border: { top: { style: "medium", color: { rgb: "000000" } } } }
        };

        const range = XLSX.utils.decode_range(ws['!ref']);
        for (let R = range.s.r; R <= range.e.r; ++R) {
          for (let C = range.s.c; C <= range.e.c; ++C) {
            const cellRef = XLSX.utils.encode_cell({ r: R, c: C });
            if (!ws[cellRef]) continue;
            let currentStyle = JSON.parse(JSON.stringify(styles.cell));
            if (R === 0) currentStyle = styles.title;
            else if (R >= 2 && R <= 3) {
              currentStyle = (C % 3 === 0) ? styles.infoLabel : styles.infoValue;
              if (C === 2) currentStyle.border = {};
            }
            else if (R === headerRowIdx) currentStyle = styles.header;
            else if (R >= dataStartRowIdx && R <= dataEndRowIdx) {
              if (C === 0 || C === 4 || C === 7) { currentStyle = styles.cellCenter; ws[cellRef].t = 'n'; }
              else if (C === 5) { currentStyle = styles.cellRight; ws[cellRef].t = 'n'; ws[cellRef].z = '0.00'; }
              else if (C === 6) { currentStyle = styles.cellRight; ws[cellRef].t = 'n'; ws[cellRef].z = '"￥"#,##0'; }
              else { currentStyle = styles.cell; currentStyle.alignment.wrapText = true; }
            }
            else if (R === totalRowIdxData) {
              if (C === 0 || C === 3 || C === 6) currentStyle = styles.totalLabel;
              else if (C === 1 || C === 7) currentStyle = styles.totalValue;
              else if (C === 4) { currentStyle = styles.totalValueRight; ws[cellRef].z = '"￥"#,##0'; }
              else { currentStyle = styles.totalValue; currentStyle.border = { top: styles.totalValue.border.top }; }
            }
            else if (R >= footerStartIdxData) {
              currentStyle = (C % 3 === 0) ? styles.infoLabel : styles.infoValue;
              if (C === 2 || C === 5) currentStyle.border = {};
            }
            if (wsData[R].every(cell => cell === "" || cell === undefined || cell === null)) currentStyle.border = {};
            ws[cellRef].s = currentStyle;
          }
        }

        ws['!cols'] = [{ wch: 5 }, { wch: 15 }, { wch: 45 }, { wch: 20 }, { wch: 8 }, { wch: 12 }, { wch: 10 }, { wch: 18 }];
        ws['!merges'] = [
          { s: { r: 0, c: 0 }, e: { r: 0, c: 7 } },
          { s: { r: totalRowIdxData, c: 1 }, e: { r: totalRowIdxData, c: 2 } },
          { s: { r: totalRowIdxData, c: 4 }, e: { r: totalRowIdxData, c: 5 } },
          { s: { r: totalRowIdxData, c: 7 }, e: { r: totalRowIdxData, c: 8 } }
        ];

        XLSX.utils.book_append_sheet(wb, ws, "报价单");
        const fileName = `报价单_${studioName}_${currentDate}.xlsx`;
        XLSX.writeFile(wb, fileName);
      }

      document.addEventListener('DOMContentLoaded', function() {
        setCurrentDate();
        updateTitle();
        const tbody = document.getElementById('quoteBody');
        if (tbody.children.length === 0) addRow();
        const urlParams = new URLSearchParams(window.location.search);
        const width = urlParams.get('width');
        const height = urlParams.get('height');
        if (width && height) {
          const firstRow = document.querySelector('#quoteBody tr');
          firstRow.querySelector('.width').value = width;
          firstRow.querySelector('.height').value = height;
          calculateRow(firstRow.querySelector('.width'));
        }
      });
    </script>
</head>
<body class="bg-gray-100 font-sans text-gray-800 p-4 md:p-8">
  <div class="container max-w-6xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
    <div class="header">
      <h1 id="quoteTitle">艺达·ART报价单</h1>
      <nav>
        <a href="./index.html">智能挂画系统</a>
        <a href="./quote.html">生成报价单</a>
      </nav>
    </div>

    <div class="info grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 p-6">
      <div>
        <label for="studioName" class="block">报价单位</label>
        <select id="studioName" onchange="updateTitle()">
          <option value="三千·ART">三千·ART</option>
          <option value="艺达·ART" selected>艺达·ART</option>
        </select>
      </div>
      <div>
        <label for="contactPhone" class="block">联系电话</label>
        <input type="text" id="contactPhone" value="18059018257">
      </div>
      <div>
        <label for="customerName" class="block">客户名称</label>
        <input type="text" id="customerName" placeholder="请输入客户名称">
      </div>
      <div>
        <label for="customerAddress" class="block">联系地址</label>
        <input type="text" id="customerAddress" placeholder="请输入联系地址">
      </div>
    </div>

    <p class="text-xs text-gray-500 px-6 mb-6">以下报价作为参考，如有任何问题请与我们联络。</p>

    <div class="button-group px-6 mb-6">
      <button onclick="addRow()">
        <span class="lucide"></span> 添加画作
      </button>
      <button onclick="exportToExcel()">
        <span class="lucide"></span> 导出Excel
      </button>
    </div>

    <div class="overflow-x-auto px-6">
      <table id="quoteTable" class="w-full text-sm">
        <thead>
          <tr>
            <th scope="col" class="text-center">序号</th>
            <th scope="col">画作形式</th>
            <th scope="col">参数</th>
            <th scope="col">作品尺寸(cm)</th>
            <th scope="col" class="text-center">数量</th>
            <th scope="col" class="text-center">平方小计(m²)</th>
            <th scope="col" class="text-center">价格(￥)</th>
            <th scope="col" class="text-center">画芯构图</th>
            <th scope="col" class="text-center">操作</th>
          </tr>
        </thead>
        <tbody id="quoteBody"></tbody>
      </table>
    </div>

    <div class="total-container px-6">
      <div class="total">
        <div>
          <span class="total-label">合计平方数:</span>
          <span id="totalArea" class="total-value">0.00</span> m²
        </div>
        <div>
          <span class="total-label">合计小写:</span>
          <span class="total-value">￥</span><span id="totalPrice" class="total-value">0</span>
        </div>
        <div>
          <span class="total-label">合计大写:</span>
          <span id="totalPriceCN" class="total-value">零元</span>
        </div>
      </div>
    </div>

    <div class="footer grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <div>
        <label for="quoter" class="block">报价人:</label>
        <input type="text" id="quoter" placeholder="请输入报价人" value="陈睿">
      </div>
      <div class="flex items-center gap-2">
        <span class="font-medium text-gray-700 whitespace-nowrap">报价日期:</span>
        <span id="currentDate" class="text-gray-900"></span>
      </div>
      <div>
        <label for="approver" class="block">审批:</label>
        <input type="text" id="approver" placeholder="请输入审批人">
      </div>
      <div class="flex items-center gap-2 col-span-1 sm:col-span-2 lg:col-span-1">
        <span class="font-medium text-gray-700 whitespace-nowrap">公司地址:</span>
        <span class="text-gray-900">福建省福州市仓山区建新镇后巷路2号</span>
      </div>
      <div>
        <label for="footerContactPhone" class="block">联系电话:</label>
        <input type="text" id="footerContactPhone" value="18059018257">
      </div>
    </div>
  </div>
</body>
</html>